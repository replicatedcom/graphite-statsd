machine:
  services:
    - docker
  environment:
    GIT_SHA1: $(echo $CIRCLE_SHA1 | cut -c -7)

checkout:
  post:
    - mkdir -p $HOME/src/github.com/replicatedcom
    - cp -r $HOME/statsd-graphite $HOME/src/github.com/replicatedcom/statsd-graphite

test:
  pre:
    - echo "No test pre commands"
  override:
    - echo "No test override commands"
  post:
    - echo "No test post commands"

deployment:
  docker:
    branch: master
    owner: replicatedcom
    commands:
      - cd $HOME/src/github.com/replicatedcom/statsd-graphite
      - sudo docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - sudo docker build --pull --rm=false -t replicated/statsd-graphite:$GIT_SHA1 .
      - sudo docker push replicated/statsd-graphite:$GIT_SHA1
